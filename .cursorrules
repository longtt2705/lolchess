# LOL Chess Project - Custom Cursor Rules

## Development Environment
- Always run `fnm use v22` before doing any development work to ensure using Node.js version 22
- Verify the correct Node version with `node --version` after switching

## Server Management
- **NEVER start development servers automatically** (npm run dev, npm start, etc.)
- The user always starts servers manually themselves
- Only provide instructions on how to start servers, don't execute the commands
- Focus on code changes, builds, and testing without starting servers

## Project Structure
- This is a monorepo with NestJS backend and React frontend
- Use workspace commands when needed: `npm run build --workspace=apps/backend`
- Always work from the project root directory: `/Users/long.tt/code/lolchess`

## Game Design
- This is a **1v1 game**, not 8-player multiplayer
- Update all references to player counts accordingly

## Frontend Styling Guidelines
**CRITICAL: Maintain consistent styling across ALL components**

### CSS Variables (Design System)
Always use these predefined CSS variables from `src/index.css`:
```css
--primary-bg: #0a0e27        /* Main dark background */
--secondary-bg: #1e2328      /* Card/component backgrounds */
--accent-bg: #3c3c41         /* Accent elements */
--primary-text: #f0e6d2      /* Main text color */
--secondary-text: #a09b8c    /* Muted/secondary text */
--gold: #c89b3c              /* Primary brand color */
--blue: #0596aa              /* Info/secondary actions */
--green: #0f2027             /* Success states */
--red: #c8aa6e               /* Errors/danger */
--border: #463714            /* Borders and dividers */
--hover: #5bc0de             /* Hover states */
```

### Component Patterns
1. **Styled Components**: Always use styled-components, never inline styles
2. **Container Pattern**: 
   - Use consistent padding: `padding: 20px;` or `padding: 40px;`
   - Use consistent max-width: `max-width: 1200px; margin: 0 auto;`
3. **Cards/Panels**:
   - Background: `background: var(--secondary-bg);`
   - Border: `border: 1px solid var(--border);`
   - Border radius: `border-radius: 8px;` or `border-radius: 12px;`
   - Box shadow: `box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);`
4. **Buttons**:
   - Primary: `background: linear-gradient(135deg, var(--gold) 0%, #b8860b 100%);`
   - Secondary: `background: transparent; border: 2px solid var(--border);`
   - Hover effects: `transform: translateY(-2px);` with appropriate box-shadow
5. **Inputs**:
   - Background: `background: var(--primary-bg);`
   - Border: `border: 2px solid var(--border);`
   - Focus: `border-color: var(--gold); box-shadow: 0 0 0 3px rgba(200, 155, 60, 0.1);`
6. **Transitions**: Always use `transition: all 0.2s ease;` for interactive elements
7. **Typography**:
   - Font family: `font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;`
   - Primary headings: `color: var(--gold);`
   - Body text: `color: var(--primary-text);`
   - Muted text: `color: var(--secondary-text);`
8. **Gradients**: Use `linear-gradient(135deg, ...)` pattern for consistency
9. **Spacing**: Use consistent gap values: 8px, 12px, 16px, 20px, 24px, 32px, 40px
10. **Icons**: Use lucide-react icons with consistent sizing (16px, 18px, 20px, 24px, 32px)

### Animation Guidelines
- Use framer-motion for complex animations
- Consistent animation durations: 0.2s for hover, 0.3s-0.6s for page transitions
- Use `whileHover={{ scale: 1.02 }}` and `whileTap={{ scale: 0.98 }}` patterns
- Entry animations: `initial={{ opacity: 0, y: 30 }}`, `animate={{ opacity: 1, y: 0 }}`

### Responsive Design
- Mobile-first approach with breakpoints
- Use flexbox and CSS Grid consistently
- Grid template: `grid-template-columns: repeat(auto-fit, minmax(250px, 1fr))`

**DO NOT DEVIATE FROM THESE PATTERNS** - Consistency is crucial for the user experience.

## Skill Animation System
**Location:** `apps/frontend/src/animations/`

### Architecture
- **Registry Pattern**: All skill animations are registered in `SkillAnimator.ts`
- **Individual Files**: Each skill has its own file in `animations/skills/`
- **Generic Fallback**: Skills without custom animations use `genericSkill.tsx`
- **Type Safety**: All animations use `.tsx` extension (not `.ts`) since they contain JSX

### Creating a New Skill Animation

1. **Create skill file**: `apps/frontend/src/animations/skills/skillName.tsx`
   ```typescript
   import React from 'react'
   import { AnimatePresence, motion } from 'framer-motion'
   import {
     SkillAnimationConfig,
     SkillAnimationRenderer,
     getPixelPosition
   } from '../types'
   
   const SkillNameAnimation: React.FC<SkillAnimationConfig> = ({
     casterPosition,
     targetPosition,
     boardRef,
     isRedPlayer = false
   }) => {
     const casterPixels = getPixelPosition(casterPosition, boardRef, isRedPlayer)
     const targetPixels = targetPosition 
       ? getPixelPosition(targetPosition, boardRef, isRedPlayer)
       : null
     
     // Your animation JSX here
     return (
       <>
         {/* Animation elements */}
       </>
     )
   }
   
   export const skillNameRenderer: SkillAnimationRenderer = {
     render: (config) => (
       <AnimatePresence>
         <SkillNameAnimation {...config} />
       </AnimatePresence>
     ),
     duration: 1000 // Duration in milliseconds
   }
   ```

2. **Register in SkillAnimator.ts**:
   ```typescript
   import { skillNameRenderer } from './skills/skillName'
   
   const skillAnimationRegistry: Record<string, SkillAnimationRenderer> = {
     'Skill Name': skillNameRenderer,
     // ... other skills
   }
   ```

### Critical: Position Calculation
**IMPORTANT**: The board coordinate system differs by player perspective:

- **Blue Player (default)**: 
  - X: `-1` to `8` (left to right)
  - Y: `7` to `0` (top to bottom) - **Y is INVERTED**
  - Grid mapping: `gridX = position.x + 1`, `gridY = 7 - position.y`

- **Red Player**:
  - X: `8` to `-1` (left to right - flipped)
  - Y: `0` to `7` (top to bottom)
  - Grid mapping: `gridX = 8 - position.x`, `gridY = position.y`

**Always use `getPixelPosition(position, boardRef, isRedPlayer)` helper** - it handles all coordinate transformations correctly.

### Reusable Components
Use these from `types.tsx`:
- `ProjectileAnimation` - For projectiles (hooks, missiles)
- `AOEAnimationComponent` - For circular area effects
- `ParticleEffectComponent` - For particle explosions
- Styled components: `ImpactEffect`, `PulseEffect`, `AOECircle`

### Example: Projectile with Chain
See `apps/frontend/src/animations/skills/rocketGrab.tsx` for a complete example of:
- Projectile traveling from caster to target
- Chain extending behind projectile
- Impact effect with particles
- Proper angle calculation

### Testing
- Test with both blue and red player perspectives
- Verify coordinates match piece positions on board
- Check animation timing and smoothness

## Preferred Workflow
1. Switch to Node v22 with `fnm use v22`
2. Make code changes following the styling guidelines above
3. Test builds: `npm run build`
4. Let the user start servers manually when they're ready
